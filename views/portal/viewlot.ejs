<%
activepage = 1;%>
<%-
include('../partials/portal-header.ejs')
%>
<style>
    body{
        background: #efefef;
    }
    .imgdisplaysmall{
        max-width:130px;
        max-height: 90px;
    }
/* Slideshow container */
.slideshow-container {
  max-width: 100%;
  padding-top: 62%;
  background: #efefef;
  position: relative;
  overflow: hidden;
}/*
.slideshow-container {
  max-width: 40%;
  padding-top: 26%;
}
.slideshow-container {
  max-width: 50%;
  padding-top: 32.5%;
}*/
.superlarge{
    max-width: 100%;
  padding-top: 65%;
}
/* Hide the images by default */
.mySlides {
  display: none;
  text-align: center;
}
.prevScroll,.nextScroll{
  cursor: pointer;
  position: absolute;
  top: 20px;
bottom: 25px;
  background: #0d0d0dd6;
  width:auto;
  padding:45px 10px;
  vertical-align:middle;
}
.nextScroll{
  right:0px;
}
.prevScroll:hover,.nextScroll:hover{
  background: #000;
}
/* Next & previous buttons */
.prev, .next {
  cursor: pointer;
  position: absolute;
  top: 50%;
  width: auto;
  margin-top: -22px;
  padding: 16px;
  color: white !important;
  font-weight: bold;
  font-size: 34px;
  transition: 0.6s ease;
  border-radius: 0 3px 3px 0;
  user-select: none;
  background: #22222263;
}
.photoimg {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    height: 100%;
    text-align: center;
    margin: auto;
}
/* Position the "next button" to the right */
.next {
  right: 0;
  border-radius: 3px 0 0 3px;
}

/* On hover, add a black background color with a little bit see-through */
.prev:hover, .next:hover {
  background-color: rgba(0,0,0,0.8);
}

/* Caption text */
.text {
  color: #f2f2f2;
  font-size: 15px;
  padding: 8px 12px;
  position: absolute;
  bottom: 30px;
  width: 100%;
  text-align: center;
}
.mydots{
    bottom: 30px;
    text-align: center;
    position: relative;
    margin: auto;
}
/* Number text (1/3 etc) */
.numbertext {
    z-index: 99;
  color: #f2f2f2;
  font-size: 12px;
  padding: 8px 12px;
  position: absolute;
  top: 0;
  background: #33333370;
}

/* The dots/bullets/indicators */
.dot {
  cursor: pointer;
  height: 15px;
  width: 15px;
  margin: 0 2px;
 /* background-color: #bbb;*/
  border: 2px solid #fff;
  border-radius: 50%;
  display: inline-block;
  transition: background-color 0.6s ease;
}

.active {
  background-color: #fff;
}
.dot:hover {
  background-color: red;
  border: 2px solid red;
}
/* Fading animation */
.fademe {
  -webkit-animation-name: fademe;
  -webkit-animation-duration: 1.5s;
  animation-name: fademe;
  animation-duration: 1.5s;
}

@-webkit-keyframes fademe {
  from {opacity: .4}
  to {opacity: 1}
}

@keyframes fademe {
  from {opacity: .4}
  to {opacity: 1}
}
.myimglistitm{
    width: 19.6%;
    padding-top: 13%;
    display: inline-block;
    background-size: cover;
    background-position:center;
    background-repeat: no-repeat;
    box-sizing: border-box;
}
.imglist{
  position: relative;
    padding:20px 0px;
    box-sizing: border-box;
    white-space: nowrap;
}
.imglistinside{
  position: relative;
    padding:0px;
    overflow-x: hidden;
    white-space: nowrap;
    margin-left: 40px;
    margin-right:40px;
}
.propertyheader{
    font-weight: 600;
    float:left;
}
.mycontainer{
    max-width:1350px;
    width:97%;
    margin: auto;
}
.mylbl{
    display: inline-block;
    min-width: 80px;;
}
body{
  background: #fff;
  font-family: 'Open Sans', sans-serif;
}
.mycontainer{
  font-family: 'Open Sans', sans-serif;
}
.lottitle{
  
  padding:10px;
  background-color:rgb(245, 245, 245)
}
.shadow-md {
    -webkit-box-shadow: 0 2px 4px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);
    box-shadow: 0 2px 4px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);
}
.cattitle{
  margin-top:30px;
  font-weight: 600;
  font-size: 16px;
}
.catdesc{
  margin-top:4px;
  font-size: 15px;
}
.cathighlight{
  margin-top:30px;
  background: #f4f4f4;
  padding:20px;

}
.cathighlight>.cattitle{
  margin-top:10px;
  font-size: 14px;
}
.cathighlight>.catdesc{
  font-size: 13px;
  font-weight: 400;
}
.propertymainprice{
  color:#c60000;
  font-size: 28px;
  font-weight: 700;
  float:right;
}
.addtolist{

}
</style>
<%
const formatToCurrency = function numberWithCommas(x) {
  return "£" +x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}/*
const formatToCurrency = amount => {
  return "£" + amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, "$&,");
};*/
%>
<div class='lottitle shadow-md'>
    <div class='mycontainer'>
    <div class='propertyheader'><%-property.name%></div>
    <div class="propertymainprice"><%-formatToCurrency(property.price)%></div>
   
    </div>
    <div style='clear:both;'></div>
</div>
<div class='mycontainer' style='margin-top:30px;'>
    <div class='leftpanel'>
<div  class="slideshow-container">
    <%
    var i = 0;
    var count = images.length
    images.forEach(f=>{i++%>
        <div class="mySlides fademe">
            <div class="numbertext"><%-i%> / <%-count%></div>
            <img src="<%-f.uri%>" class='photoimg'>
          <!--  <div class="text">Caption Text</div>-->
          </div>
    <%})%>
    
    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
    <a class="next" onclick="plusSlides(1)">&#10095;</a>
    <div class='mydots' style="text-align:center">
        <%
        var i =0;
        images.forEach(f=>{ i++;%>
        <span class="dot" onclick="currentSlide(<%-i%>)"></span>
        <%})%>
      </div>
</div>
<div class='cattitle'><%-property.header%></div>
<div class='catdesc'><%-property.description%></div>
<%
    var i =0;
    details.forEach(f=>{
        if(f.details){
          var mytmpclass='catgeneral'
          if(f.title=='Additional Fees'){
            mytmpclass='cathighlight'
          }
          %>
            <div class='<%-mytmpclass%>'><div class='cattitle'><%-f.title%></div><div class='catdesc'><%-f.details%></div></div>
            <%  }
    })%>

</div>
<div class='rightpanel'>
 
  <div style='border:1px solid #000;background:#f0f0f0;padding:20px;margin-top:15px;text-align:center;'>
    <%if(isuser){
        if(!isAdded){%>
          <button id='btnAddFav'>Add to My List</button>
        <%}else{
          if(!biddeposit){
            %> <button id='btnBidDeposit'>Add to I want to Bid during Auction</button><%
          }else{
            %> <button id='btnRemoveBidDeposit'>I will not be bidding during Auction</button><%
          }
          %>

          <button id='btnRemoveFav'>Remove from My List</button>
        <%}
    }else{%>
      Please Log In or Complete Registration to Add to Favorites or Be Eligible to Bid
    <%}%>
</div>
  <div>
    <div style='color:#fff; background:#c60000;padding:3px 8px;font-weight:600;font-size:14px;margin-bottom:10px;'>Maps</div>
    <div style='height:300px;width:100%;' id="map"></div>
   
    <%maps.forEach(m=>{%>
      <div style='margin-top:10px;'>
        <img src='<%-m.uri%>' style='width:100%;'/>
      </div>
    <%})%>
  </div>
  <div>
    <%catalogs.forEach(m=>{%>
      <div style='margin-top:10px;'><div style='color:#fff; background:#c60000;padding:3px 8px;font-weight:600;font-size:14px;margin-bottom:10px;'>Catalog</div>
        <a href='<%-m.uri%>'>Catalog Download</a>
      </div>
    <%})%>
  </div>
</div>
</div>
<div style='clear:both;margin-bottom:200px;'></div>
</div>
<script>



  var propertyid = "<%-property.id%>";
var slideIndex = 1;
showSlides(slideIndex);

// Next/previous controls
function plusSlides(n) {
  showSlides(slideIndex += n);
}

// Thumbnail image controls
function currentSlide(n) {
  showSlides(slideIndex = n);
}

function showSlides(n) {
  var i;
  var slides = document.getElementsByClassName("mySlides");
  var dots = document.getElementsByClassName("dot");
  if (n > slides.length) {slideIndex = 1}
  if (n < 1) {slideIndex = slides.length}
  for (i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";
  }
  for (i = 0; i < dots.length; i++) {
      dots[i].className = dots[i].className.replace(" active", "");
  }
  slides[slideIndex-1].style.display = "block";
  dots[slideIndex-1].className += " active";
}
function sideScroll(direction){
  var element = document.getElementById('imgList')
  var step = 10;
  var distance =200;
  var speed = 3;
    scrollAmount = 0;
    console.log(direction)
    var slideTimer = setInterval(function(){
        if(direction == 'left'){
            element.scrollLeft -= step;
        } else {
            element.scrollLeft += step;
        }
        scrollAmount += step;
        if(scrollAmount >= distance){
          console.log('DONE');
            window.clearInterval(slideTimer);
        }
    }, speed);
}

$('#btnAddFav').click(function(){
  $.post('/addtofav',{propertyid:propertyid},function(data){
    console.log(data)
    location.reload();
  },'json')
})
$('#btnRemoveFav').click(function(){
  $.post('/removefromfav',{propertyid:propertyid},function(data){
    console.log(data)
    location.reload();
  },'json')
})
$('#btnBidDeposit').click(function(){
  $.post('/addBidDeposit',{propertyid:propertyid},function(data){
    console.log(data)
    location.reload();
  },'json')
})
$('#btnRemoveBidDeposit').click(function(){
  $.post('/removeBidDeposit',{propertyid:propertyid},function(data){
    console.log(data)
    location.reload();
  },'json')
})
</script>
<%console.log(property)%>
<script>
  let map;

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: <%-property.latitude%>, lng: <%-property.longitude%>},
    zoom: 16,
  });
}

</script>

<script async
    src="https://maps.googleapis.com/maps/api/js?key=<%-apikey%>&callback=initMap">
</script>

